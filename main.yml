---
  - hosts: pi
    vars_files:
      - env_vars.yml
    tasks:
      # basic things we need for the host
      - include: tasks/update.yml
        tags:
          - prep
          - update
      - include: tasks/prep.yml
        tags:
          - prep
      # homebridge and add-ons
      - include: tasks/homebridge/install.yml
        tags: homebridge
      - include: tasks/homebridge_chamberlain/install.yml 
        tags: chamberlain
      - include: tasks/mqtt/install.yml 
        tags: 
          - mqtt
          - install
      - include: tasks/mqtt/configure.yml 
        tags: mqtt
      - include: tasks/mqtt/restart.yml
        tags:
          - mqtt
          - restart
      - include: tasks/homebridge/restart.yml
        tags:
          - homebridge
          - chamberlain
          - restart
      # iq_envoy monitor
      - include: tasks/monitoring_scripts/install.yml
        tags:
          - monitoring
      # NODE RED
      - include: tasks/node_red/install.yml
        tags:
          - nodered
          - install
      - include: tasks/node_red/install_plugins.yml
        tags:
          - nodered
          - plugins
      - include: tasks/node_red/restart.yml
        tags:
          - nodered
          - restart